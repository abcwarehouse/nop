!function(s,t,o){var e=".shop-resources",a=s(e),i=".shops-sorting-filtering-wrapper",n=".shops-list",l=parseInt(s(e).attr("data-mapzoomlevel"))||15,r={type:"allShopsMap",wrapperId:"all-shops-map-holder",wrapperSelector:"#all-shops-map-holder",mapSearchInputId:"shop-address-input",directionsPanelId:"directions-panel",resourcesSelector:e,getCurrentLocationSelector:"#get-current-location",radiusFieldSelector:"#searchRadius",directionsContainer:".directions-wrapper, .all-shops-page .map-wrapper, #backToResults",directionsShownClass:"directions-shown",centerLatitude:s(e).attr("data-latitude"),centerLongitude:s(e).attr("data-longitude"),initialZoom:l,source:"https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places&callback=storeLocatorAllShops.initializeAllShopsMap"},c={},p=!1,h=1,d=!1,u=!1;function f(){s(window).off("scroll.allshopsinfinitescroll resize.allshopsinfinitescroll orientationchange.allshopsinfinitescroll").on("scroll.allshopsinfinitescroll resize.allshopsinfinitescroll orientationchange.allshopsinfinitescroll",function(){!function(){var o=s(n);if(0===o.length)return;var e=s(window).outerHeight(),t=s(window).scrollTop(),a=o.innerHeight(),i=o.offset().top;if(a+i<e+t){if(1==d)return;g(h+=1)}}()})}function g(o){var t=o&&0<o;t?s("#all-shops-infinite-scroll-loader").show():(h=1,s("#all-shops-list-panel-loader").show());var e=function(){var o="",e="";c&&c.position&&(o=c.position.lat(),e=c.position.lng());var t=s(i+" #searchRadius").val();return t||(t=a.attr("data-defaultdistanceradius"),s(i+" #searchRadius").val(t)),{latitude:o,longitude:e,radius:t,tag:s.trim(s(i+" #searchByTagsInput").val()),sortBy:s(i+" #sortingSelect").val(),pageNumber:h}}();d=!0,s.ajax({cache:!1,type:"POST",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",url:a.attr("data-searchshopsurl")}).done(function(o){d=!1;var e=s(o);t||s(n).empty(),s(n).append(e),e.length<a.attr("data-shopslistpagesize")?(s(window).off("scroll.allshopsinfinitescroll resize.allshopsinfinitescroll orientationchange.allshopsinfinitescroll"),u=!0):u&&f(),s(".no-shops-after-filtering").toggle(0==e.length&&!t),s("#all-shops-infinite-scroll-loader").hide(),s("#all-shops-list-panel-loader").hide()}).fail(function(){console.log("Loading the page failed.")})}o.initializeAllShopsMap=function(){t.initializeMap(),t.createMapSearchBox(),f(),s(document).on("click",".show-directions",function(){var o=s(this).attr("data-latitude"),e=s(this).attr("data-longitude");p?t.showDirectionsToShop(o,e,".all-shops-page"):t.createUserMarker(setDefaultPositionIfGeolocationDisabled=!0).then(function(o){c=o}).finally(function(){p=!0,t.showDirectionsToShop(o,e,".all-shops-page")})})},s(document).ready(function(){0<s(r.resourcesSelector).length&&0<s(r.wrapperSelector).length&&(t.appendMapScript(r),s(r.getCurrentLocationSelector).on("click",function(){var o;o=zoomMap=!0,t.createUserMarker(setDefaultPositionIfGeolocationDisabled=!0).then(function(o){c=o}).finally(function(){p=!0,o&&t.zoomMapToSelectedSearchRadius()})}),s("#backToResults").on("click",function(){t.clearMapRoute(),s(".directions-wrapper, .all-shops-page .map-wrapper, #backToResults").removeClass("directions-shown")}),s("#sortingSelect, #searchRadiusWrapper, #searchByTagsInput").on("change",g),s(document).on("userPositionChanged",function(o){c.position=o.position,g()}))})}(jQuery,storeLocatorCore,window.storeLocatorAllShops=window.storeLocatorAllShops||{});