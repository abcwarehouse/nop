<span id='{GUID}'></span>
    <script>
        ga('ec:addImpression', {
            'id': '{PRODUCTSKU}',                   // Product details are provided in an impressionFieldObject.
            'name': '{PRODUCTNAME}',
            'category': '{PRODUCTCATEGORY}',
            'brand': '{MANUFACTURER}',
            'list': '{LIST}',
            'position': {POSITION}
        });

    $(document).ready(function(){
        $('#{GUID}').closest('.item-box, .block-recently-viewed-products ul.list li').find('.product-item .picture > a, .product-item .product-title a, a.product-name').click(function(){
            var destination = $(this).attr('href');

            ga('ec:addProduct', {
                'id': '{PRODUCTSKU}',
                'name': '{PRODUCTNAME}',
                'category': '{PRODUCTCATEGORY}',
                'brand': '{MANUFACTURER}',
                'position': {POSITION}
            });
            ga('ec:setAction', 'click', {list: '{LIST}'});

            // Send click with an event, then send user to product page.
            ga('send', 'event', 'UX', 'click', '{LIST}', {
                hitCallback: googleTimeoutFunction(function() {
					dcSentToGoogleEventTrigger(function(){setDocumentLocation(destination);});
					})
            });

        });
		function setDocumentLocation(destination){
			document.location = destination;
		}
        var addtoCartButton = $('#{GUID}').closest('.item-box').find('.product-box-add-to-cart-button');
        var originalClickFunction = addtoCartButton.attr('onclick');
        addtoCartButton.removeAttr('onclick');

		function fireOriginalClick(){
			(new Function(originalClickFunction)())
		}

		function googleTimeoutFunction(callback, opt_timeout) {
			var called = false;
			function fn() {
			  if (!called) {
				called = true;
				callback();
			  }
			}
			setTimeout(fn, opt_timeout || 1000);
			return fn;
		  }
		function dcSentToGoogleEventTrigger(callback){
			$(document).trigger('dcSentToGoogleEvent');
			callback();
    
		}

        addtoCartButton.click(function(){
            var qty = 1;
            ga('ec:addProduct', {
                'id': '{PRODUCTSKU}',
                'name': '{PRODUCTNAME}',
                'category': '{PRODUCTCATEGORY}',
                'brand': '{MANUFACTURER}',
                'quantity': qty
            });
            ga('ec:setAction', 'add');

            // Send click with an event, then send user to product page.
            ga('send', 'event', 'UX', 'click', 'add to basket', {
                hitCallback: googleTimeoutFunction(function() {
					dcSentToGoogleEventTrigger(function(){fireOriginalClick();});
					})
            });
                
        });
    });
    </script>