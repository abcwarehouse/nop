!function(i,r){var s,g,l,d,a,c,p,n,m=!1,t=!1,u=[],f=new RegExp(/^-?\d+\.?\d*$/);function o(a,e){var t=new google.maps.LatLng(a.lat,a.lng),o=new google.maps.Marker({position:t,title:a.title,draggable:e});"true"!==g.attr("data-manuallysetmapbounds")&&(n.extend(t),c.setCenter(t)),o.setMap(c),u.push(o),"shopDetailsMap"!=s.type&&google.maps.event.addListener(o,"click",function(){var e="<h5>"+a.title+"</h5>",t=a.shortdescription;t&&(e+="<div>"+t+"</div>"),new google.maps.InfoWindow({maxWidth:400,content:e}).open(c,o)})}function v(e){if(m)p.setPosition(e);else{var t={map:c,position:e,icon:g.attr("data-pathtoimages")+"/squat_marker_green_thumb.png",animation:google.maps.Animation.DROP,title:g.attr("data-youarehere"),draggable:!0},a=new google.maps.Marker(t);a.setMap(c),p=a,m=!0,google.maps.event.addListener(a,"dragend",function(){i.event.trigger({type:"userPositionChanged",position:p.position})})}i(s.getCurrentLocationSelector).hide(),i.event.trigger({type:"userPositionChanged",position:p.position})}r.appendMapScript=function(e){if(e){var t=(g=i((s=e).resourcesSelector)).attr("data-googleapikey").trim(),a=g.attr("data-maplanguagecode").trim();t&&(s.source+="&key="+t),a&&(s.source+="&language="+a);var o=document.createElement("script");o.src=s.source,document.body.appendChild(o)}},r.initializeMap=function(){var e=document.getElementById(s.wrapperId),t={center:new google.maps.LatLng(s.centerLatitude,s.centerLongitude),zoom:s.initialZoom,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:function(){var e=g.attr("data-mapstyles"),t="";if(!e)return"";try{t=JSON.parse(e)}catch(e){console.log("Invalid custom map styles value!")}return t}()};c=new google.maps.Map(e,t),google.maps.event.addListenerOnce(c,"idle",function(){!function(){var e=function(){var e=[],t=g.attr("data-markersdata");if(t)for(var a=JSON.parse(t),o=0;o<a.length;o++){var n=a[o].Latitude,i=a[o].Longitude;if(null!=n&&null!=i&&f.test(n)&&f.test(i)){var r={id:a[o].Id,lat:n,lng:i,title:a[o].Name,shortdescription:a[o].ShortDescription};e[o]=r}}var s=g.attr("data-shoplatitude"),l=g.attr("data-shoplongitude"),d=g.attr("data-shopname");s&&l&&(e[0]={lat:s,lng:l,title:d});return e}();if(0==e.length)return;n=new google.maps.LatLngBounds;for(var t=0;t<e.length;t++)null!=e[t]&&o(e[t],!1);"true"!==g.attr("data-manuallysetmapbounds")&&r.alignMap();"undefined"!=typeof MarkerClusterer&&(a=new MarkerClusterer(c,u,{imagePath:"https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m"}))}()})},r.showDirectionsToShop=function(e,t,a){if(void 0===l&&(l=new google.maps.DirectionsService),void 0===d&&(d=new google.maps.DirectionsRenderer).setPanel(document.getElementById(s.directionsPanelId)),m){if(e&&t)destination=new google.maps.LatLng(e,t);else{if(!u[0]||!u[0].position)return;destination=u[0].position}var o="Imperial"==g.attr("data-units"),n={origin:p.position,destination:destination,travelMode:google.maps.TravelMode.DRIVING,unitSystem:o?google.maps.UnitSystem.IMPERIAL:google.maps.UnitSystem.METRIC};l.route(n,function(e,t){t==google.maps.DirectionsStatus.OK?(d.setMap(c),d.setDirections(e),r.displayInformationMessage(""),i(s.directionsContainer).addClass(s.directionsShownClass),r.clearMarkers()):(r.displayInformationMessage(g.attr("data-unabletoshowdirections")),i(s.directionsContainer).removeClass(s.directionsShownClass),r.clearMapRoute()),a&&i("html,body").animate({scrollTop:i(a).offset().top},"slow")})}},r.clearMapRoute=function(){void 0!==d&&(d.setMap(null),t&&r.showMarkers())},r.createUserMarker=function(a){return new Promise(function(t,e){new Promise(function(t,a){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){t(e.coords)},function(e){a(e)})}).then(function(e){v(new google.maps.LatLng(e.latitude,e.longitude)),t(p)}).catch(function(e){a?(v(new google.maps.LatLng(c.center.lat(),c.center.lng())),t(p)):t();r.displayInformationMessage(g.attr("data-geolocationdenied"))})})},r.zoomMapToSelectedSearchRadius=function(){var e=parseFloat(i(s.radiusFieldSelector).val());if(!(!m&&isNaN(e)&&e<=0)){"Imperial"==g.attr("data-units")&&(e*=1.609344),5e3<e&&(e=5e3);var t=new google.maps.Circle({center:p.getPosition(),map:c,visible:!1,zIndex:0,radius:1e3*e});r.alignMap(t.getBounds()),c.setZoom(c.getZoom()+2)}},r.createMapSearchBox=function(){var e=document.getElementById(s.mapSearchInputId);c.controls[google.maps.ControlPosition.TOP_LEFT].push(e);var t=new google.maps.places.Autocomplete(e,{fields:["formatted_address","place_id","name","geometry"]});e.style.display="block",t.addListener("place_changed",function(){var e=t.getPlace();e.geometry&&e.geometry.location&&(v(e.geometry.location),i(s.directionsContainer).removeClass(s.directionsShownClass),r.clearMapRoute(),r.zoomMapToSelectedSearchRadius())})},r.alignMap=function(e){"true"!=g.attr("data-manuallysetmapbounds")||e?(c.fitBounds(e||n),google.maps.event.addListenerOnce(c,"bounds_changed",function(e){var t=parseInt(g.attr("data-mapzoomlevel"))||15;this.setZoom(Math.min(t,this.getZoom()))})):(c.setCenter(new google.maps.LatLng(s.centerLatitude,s.centerLongitude)),c.setZoom(s.initialZoom))},r.displayInformationMessage=function(e,t){i(t=t||".additional-info").text(e)},r.showMarkers=function(){for(var e=0;e<u.length;e++)u[e].setMap(c);void 0!==a&&(a=new MarkerClusterer(c,u,{imagePath:"https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m"})),t=!1},r.clearMarkers=function(){for(var e=0;e<u.length;e++)u[e].setMap(null);void 0!==a&&a.clearMarkers(),t=!0}}(jQuery,window.storeLocatorCore=window.storeLocatorCore||{});