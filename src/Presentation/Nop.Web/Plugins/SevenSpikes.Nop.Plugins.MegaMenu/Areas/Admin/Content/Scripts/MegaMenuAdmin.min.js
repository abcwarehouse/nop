/*
* Copyright 2017 Seven Spikes Ltd. All rights reserved. (http://www.nop-templates.com)
* http://www.nop-templates.com/t/licensinginfo
*/

!function(u,m){var r,l={};function d(){u(".save-settings-button").on("click",function(e){var i,r;return i=!0,u(".edit-menu-item-title, .edit-menu-item-url").not(".localized").each(function(){var e=u(this);if(""===e.val()){var t=e.closest(".menu-item");return t.isColumn()||t.isRow()||t.isPicture()?!0:(t.hasClass("menu-item-edit-inactive")&&(t.find(".menu-item-settings .nav-tabs li:first a").tab("show"),t.find(".item-edit").click()),e.addClass("invalid").one("focus",function(){u(this).removeClass("invalid")}),i=!1)}}),i?(m.isLoaded&&(r=1,u("#menu-to-edit > .menu-item").each(function(){var e=u(this),t=e.menuItemDepth(),i=0===t?t:parseInt(t-1,10),a=e.prevAll(".menu-item-depth-"+i).first(),t=!e.hasClass("menu-item-depth-0")&&parseInt(a.attr("data-menuItemId"))||0,i=e.find(".edit-menu-item-entityId").val();e.isPicture()&&(i=e.find("#EntityId").val());var n,a=e.find("#SelectedCustomerRoleIds").data("kendoMultiSelect").value().map(Number),d={id:parseInt(e.attr("data-menuItemId"))||0,type:parseInt(e.find(".item-type").attr("data-itemType"))||0,title:e.find(".edit-menu-item-title").val()||"",url:e.find(".edit-menu-item-url").val()||"",openInNewWindow:e.find(".edit-menu-item-openinnewwindow").is(":checked"),cssClass:e.find(".edit-menu-item-classes").val()||"",maximumNumberOfEntities:parseInt(e.find(".edit-menu-item-maximum-number-of-entities").val())||0,numberOfBoxesPerRow:parseInt(e.find(".edit-menu-item-number-of-boxes-per-row").val())||0,imageSize:parseInt(e.find(".edit-menu-item-image-size").val())||0,entityId:parseInt(i)||0,width:parseFloat(e.find(".edit-menu-item-width").val())||0,catalogTemplate:parseInt(e.find(".edit-menu-item-template").val())||0,parentMenuItemId:t,displayOrder:r,selectedCustomerRoleIds:a};for(n in d)if(d.hasOwnProperty(n))if("selectedCustomerRoleIds"==n)for(var o=0;o<d[n].length;o++)u("#mega-menu-edit-tabs").append('<input type="hidden" name="Items['+(r-1)+"]."+n+"["+o+']" value="'+d[n][o]+'" />');else u("#mega-menu-edit-tabs").append('<input type="hidden" name="Items['+(r-1)+"]."+n+'" value="'+d[n]+'" />');e.find(".edit-menu-item-title.localized, .edit-menu-item-url.localized, .edit-menu-item-language-id").each(function(){var e=u(this),t=e.attr("name"),e=e.val();u("#mega-menu-edit-tabs").append('<input type="hidden" name="Items['+(r-1)+"]."+t+'" value="'+e+'" />')}),r++})),void u("#mega-menu-edit-tabs").append('<input type="hidden" name="UpdateMenuItems" value="'+m.isLoaded+'" />')):(e.preventDefault(),void e.stopPropagation())})}function s(e){u(e).find(".checkbox:checked").click()}function o(e,i,t,a,n){var d={},o=u(e),e="Name";"topics"===n&&(e="Title (System Name)");var r,m=o.kendoGrid({dataSource:{type:"json",transport:{read:{type:"POST",url:o.attr("data-readUrl"),dataType:"json",contentType:"application/json"},parameterMap:function(e,t){return"read"!==t?e:JSON.stringify(e)}},serverFiltering:!0,serverPaging:!0,pageSize:8,schema:{data:"Data",total:"Total",errors:"Errors",model:{id:"Id",fields:{Name:{editable:!1,type:"string"}}}}},scrollable:{virtual:!0},autoBind:!1,dataBound:function(e){if(e.sender.virtualScrollable._fetching)for(var t=this.dataSource.view(),i=0;i<t.length;i++)d[t[i].Id]&&this.tbody.find("tr[data-itemId='"+t[i].Id+"']").addClass("k-state-selected").find(".checkbox").attr("checked","checked")},toolbar:kendo.template(u(a).html()),columns:[e],rowTemplate:kendo.template(u(t).html())}).data("kendoGrid");m.table.on("click",".checkbox",function(){var e=this.checked,t=u(this).closest("tr"),i=m.dataItem(t);(d[i.id]=e)?t.addClass("k-state-selected"):t.removeClass("k-state-selected")}),t="oninput"in document.createElement("input")?"input":"keyup",u(i).on(t,function(){var t=u(this).val();r&&clearTimeout(r),r=setTimeout(function(){d=[];var e=t?"#topics-autocomplete"===i?{logic:"or",filters:[{field:"Title",operator:"contains",value:t},{field:"SystemName",operator:"contains",value:t}]}:{field:"Name",operator:"contains",value:t}:{};m.dataSource.filter(e)},500)}).on("keydown",function(e){13===e.which&&(e.preventDefault(),e.stopPropagation())}).attr("autocomplete","off"),l[n]=function(){var e,t=[];for(e in d)d.hasOwnProperty(e)&&d[e]&&t.push(e);return t}}function a(e){var t=e.val(),i="0"===t,a="5"===t,t=e.closest(".menu-item-settings");t.find(".field-image-size").toggle(a),t.find(".field-number-of-boxes-per-row").toggle(a),t.find(".field-maximum-number-of-entities").toggle(!i);e=t.find(".field-maximum-number-of-entities > label > span"),i=e.attr("data-subCategories"),t=e.attr("data-entities");i&&t&&(t=a?i:t,e.text(t))}function c(e){e.each(function(){var i=u(this);u.data(this,"current",i.val()),i.off("change").on("change",function(){var e=i.closest(".menu-item"),t=e.menuItemDepth(),t=e.prevAll(".menu-item-depth-"+(t-1)).first(),e=e.childMenuItems();if("0"!==i.val()&&(0<e.length||0<t.length&&!t.isColumn()))return i.val(u.data(this,"current")),u(".automatic-orphaning").show(),void setTimeout(function(){u(".automatic-orphaning").fadeOut()},4e3);u.data(this,"current",i.val()),a(i)}),a(i)})}u(document).ready(function(){var e,t,i,a,n;u("body").addClass("nav-menus-php"),r=u("#mega-menu-info"),bindBootstrapTabSelectEvent("mega-menu-edit-tabs"),u("#SubmitCustomLink").on("click",function(e){e.preventDefault();var t=!0,i=u(this).closest(".add-menu-item-form"),a=i.find("#CustomLinkTitle"),n=i.find("#CustomLinkUrl"),d=a.val(),e=n.val();""===d&&(a.addClass("invalid"),t=!1),""===e&&(n.addClass("invalid"),t=!1),t&&(m.addItemToMenu(i,{id:0,title:d,url:e,Type:200,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:0,ParentMenuItemId:0},m.addMenuItemToBottom),a.val(""),n.val(""))}),u("#CustomLinkTitle, #CustomLinkUrl").on("focus",function(){u(this).removeClass("invalid"),u(this).closest(".add-menu-item-form").find(".error-message").remove()}),u("#SubmitPageLink").on("click",function(e){e.preventDefault();var t=u(this).closest("#add-page-link-form"),e=t.find('input[type="checkbox"]:checked');0!==e.length&&(e.each(function(){m.addItemToMenu(t,{id:0,title:u(this).next("span").text(),url:"",Type:u(this).val(),OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:0,ParentMenuItemId:0},m.addMenuItemToBottom)}),s("#add-page-link-form"))}),o("#categories-grid","#categories-autocomplete","#categoriesRowTemplate","#categoriesGridToolbarTemplate","categories"),e=!1,c(u(".edit-menu-item-template")),u('input[name="category-type"]').on("change",function(){u("#category-all-item").is(":checked")?u("#categories-grid").fadeOut():u("#categories-grid").fadeIn(),e||(u("#categories-grid").data("kendoGrid").dataSource.read(),e=!0)}),u("#SubmitCategoryLink").on("click",function(e){e.preventDefault();var t=u(this).closest("#add-category-link-form"),i=u("#category-all-item"),e=i.is(":checked"),a=i.val();if(e)m.addItemToMenu(t,{id:0,title:r.attr("data-menuItemProducts"),url:"",Type:a,CatalogTemplate:5,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:0,ParentMenuItemId:0},m.addMenuItemToBottom,function(){c(u("#menu-to-edit > li:last-child .edit-menu-item-template"))});else{for(var n=l.categories(),d=0;d<n.length;d++){var o=parseInt(n[d]);isNaN(o)||m.addItemToMenu(t,{id:0,title:"",url:"",Type:a,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:o,ParentMenuItemId:0},m.addMenuItemToBottom,function(){c(u("#menu-to-edit > li:last-child .edit-menu-item-template"))})}s("#categories-grid")}}),o("#topics-grid","#topics-autocomplete","#topicsRowTemplate","#topicsGridToolbarTemplate","topics"),t=!1,u('input[name="topic-type"]').on("change",function(){u("#topic-all-item").is(":checked")?u("#topics-grid").fadeOut():u("#topics-grid").fadeIn(),t||(u("#topics-grid").data("kendoGrid").dataSource.read(),t=!0)}),u("#SubmitTopicLink").on("click",function(e){e.preventDefault();var t=u(this).closest("#add-topic-link-form"),i=u("#topic-all-item"),e=i.is(":checked"),a=i.val();if(e)m.addItemToMenu(t,{id:0,title:r.attr("data-menuItemTopics"),url:"",Type:a,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:0,ParentMenuItemId:0},m.addMenuItemToBottom);else{for(var n=l.topics(),d=0;d<n.length;d++){var o=parseInt(n[d]);isNaN(o)||m.addItemToMenu(t,{id:0,title:"",url:"",Type:a,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:o,ParentMenuItemId:0},m.addMenuItemToBottom)}s("#topics-grid")}}),o("#manufacturers-grid","#manufacturers-autocomplete","#manufacturersRowTemplate","#manufacturersGridToolbarTemplate","manufacturers"),i=!1,c(u(".edit-menu-item-template")),u('input[name="manufacturer-type"]').on("change",function(){u("#manufacturer-all-item").is(":checked")?u("#manufacturers-grid").fadeOut():u("#manufacturers-grid").fadeIn(),i||(u("#manufacturers-grid").data("kendoGrid").dataSource.read(),i=!0)}),u("#SubmitManufacturerLink").on("click",function(e){e.preventDefault();var t=u(this).closest("#add-manufacturer-link-form"),i=u("#manufacturer-all-item"),e=i.is(":checked"),a=i.val();if(e)m.addItemToMenu(t,{id:0,title:r.attr("data-menuItemManufacturers"),url:"",Type:a,CatalogTemplate:5,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:0,ParentMenuItemId:0},m.addMenuItemToBottom,function(){c(u("#menu-to-edit > li:last-child .edit-menu-item-template"))});else{for(var n=l.manufacturers(),d=0;d<n.length;d++){var o=parseInt(n[d]);isNaN(o)||m.addItemToMenu(t,{id:0,title:"",url:"",Type:a,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:o,ParentMenuItemId:0},m.addMenuItemToBottom,function(){c(u("#menu-to-edit > li:last-child .edit-menu-item-template"))})}s("#manufacturers-grid")}}),o("#vendors-grid","#vendors-autocomplete","#vendorsRowTemplate","#vendorsGridToolbarTemplate","vendors"),a=!1,c(u(".edit-menu-item-template")),u('input[name="vendor-type"]').on("change",function(){u("#vendor-all-item").is(":checked")?u("#vendors-grid").fadeOut():u("#vendors-grid").fadeIn(),a||(u("#vendors-grid").data("kendoGrid").dataSource.read(),a=!0)}),u("#SubmitVendorLink").on("click",function(e){e.preventDefault();var t=u(this).closest("#add-vendor-link-form"),i=u("#vendor-all-item"),e=i.is(":checked"),a=i.val();if(e)m.addItemToMenu(t,{id:0,title:r.attr("data-menuItemVendors"),url:"",Type:a,CatalogTemplate:5,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:0,ParentMenuItemId:0},m.addMenuItemToBottom,function(){c(u("#menu-to-edit > li:last-child .edit-menu-item-template"))});else{for(var n=l.vendors(),d=0;d<n.length;d++){var o=parseInt(n[d]);isNaN(o)||m.addItemToMenu(t,{id:0,title:"",url:"",Type:a,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:o,ParentMenuItemId:0},m.addMenuItemToBottom,function(){c(u("#menu-to-edit > li:last-child .edit-menu-item-template"))})}s("#vendors-grid")}}),o("#product-tags-grid","#product-tags-autocomplete","#productTagsRowTemplate","#productTagsGridToolbarTemplate","productTags"),n=!1,u('input[name="product-tags-type"]').on("change",function(){u("#product-tags-all-item").is(":checked")?u("#product-tags-grid").fadeOut():u("#product-tags-grid").fadeIn(),n||(u("#product-tags-grid").data("kendoGrid").dataSource.read(),n=!0)}),u("#SubmitProductTagsLink").on("click",function(e){e.preventDefault();var t=u(this).closest("#add-product-tag-link-form"),i=u("#product-tags-all-item"),e=i.is(":checked"),a=i.val();if(e)m.addItemToMenu(t,{id:0,title:r.attr("data-menuItemProductTags"),url:"",Type:a,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:0,ParentMenuItemId:0},m.addMenuItemToBottom);else{for(var n=l.productTags(),d=0;d<n.length;d++){var o=parseInt(n[d]);isNaN(o)||m.addItemToMenu(t,{id:0,title:"",url:"",Type:a,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:o,ParentMenuItemId:0},m.addMenuItemToBottom)}s("#product-tags-grid")}}),u("#SubmitLayout").on("click",function(e){e.preventDefault();var t=u(this).closest(".add-menu-item-form"),i=t.find("#LayoutTitle"),a=t.find("#LayoutType"),e=i.val(),a=a.val();""!==e?(m.addItemToMenu(t,{id:0,title:e,url:"",Type:a,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:0,ParentMenuItemId:0},m.addMenuItemToBottom),i.val("")):i.addClass("invalid")}),u("#LayoutTitle").on("focus",function(){u(this).removeClass("invalid"),u(this).closest(".add-menu-item-form").find(".error-message").remove()}),u("#SubmitColumn").on("click",function(e){e.preventDefault();var t=u(this).closest(".add-menu-item-form"),e=u("#ParentColumnsLayout").val();m.addItemToMenu(t,{id:0,title:"",url:"",Type:155,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:0,ParentMenuItemId:e},m.addMenuItemToElement)}),u("#SubmitRow").on("click",function(e){e.preventDefault();var t=u(this).closest(".add-menu-item-form"),e=u("#ParentRowsLayout").val();m.addItemToMenu(t,{id:0,title:"",url:"",Type:156,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:0,ParentMenuItemId:e},m.addMenuItemToElement)}),u("#SubmitPicture").on("click",function(e){e.preventDefault();e=u(this).closest(".add-menu-item-form");m.addItemToMenu(e,{id:0,title:"",url:"",Type:160,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:0,ParentMenuItemId:0},m.addMenuItemToBottom)}),d()})}(jQuery,megaMenu);