!function(m,g,f){var d,p,l,u,v,F,T,D,e;function t(){var e,t=f.getHiddenValFromDom("#create-condition-group-url"),o=f.getHiddenValFromDom("#condition-id"),n=m("#conditionResources").attr("data-createConditionGroupFail");""!==t&&""!==o&&(e={conditionId:o},addAntiForgeryToken(e),m.ajax({cache:!1,type:"POST",data:e,url:t,success:function(e){a(e),r(e)},error:function(){alert(n)}}))}function o(){var e,t=f.getHiddenValFromDom("#delete-condition-group-url"),o=m(this).closest(".condition-group-grid"),n=m(o).attr("id"),i=m(o).attr("data-conditionGroupId"),a=m("#conditionResources").attr("data-deleteConditionGroupFail");""!==t&&i&&n&&(e={conditionGroupId:i},addAntiForgeryToken(e),m.ajax({cache:!1,type:"POST",data:e,url:t,success:function(){m("#"+n).data("kendoGrid").destroy(),m("#"+n).parent(".condition-group-wrapper").remove()},error:function(){alert(a)}}))}function n(){var e=f.getHiddenValFromDom("#update-condition-url"),t=f.getHiddenValFromDom("#condition-id"),o=f.getHiddenValFromDom("#condition #ConditionName"),n=f.getHiddenValFromDom("#condition #DefaultConditionValue"),i=m("#conditionResources").attr("data-updateConditionFail"),a={ConditionName:o,Active:m("#condition #Active").prop("checked"),DefaultConditionValue:n,conditionId:t};addAntiForgeryToken(a),m.ajax({cache:!1,type:"POST",data:a,url:e,error:function(){alert(i)}})}function i(){var e=f.getHiddenValFromDom("#update-default-condition-group-statement-url"),t=f.getHiddenValFromDom("#condition-id"),o=m("#conditionResources").attr("data-updateConditionStatementFail"),n={conditionId:t,defaultConditionStatementValue:m("#condition #DefaultConditionValue").find(":selected").val()};addAntiForgeryToken(n),m.ajax({cache:!1,type:"POST",data:n,url:e,error:function(){alert(o)}})}function a(e){var t='<div class="condition-group-wrapper"><div class="condition-group-grid" id="'+("condition-group-grid-"+e)+'" data-conditionGroupId="'+e+'"></div><div class="group-dependancy-text"><p>--OR--</p></div></div>';m("#condition-groups-wrapper").append(t)}function r(i){var e="condition-group-grid-"+i,t=f.getHiddenValFromDom("#read-condition-group-url"),o=f.getHiddenValFromDom("#update-condition-statement-url"),n=f.getHiddenValFromDom("#destroy-condition-statement-url"),a=f.getHiddenValFromDom("#create-condition-statement-url"),r=new g.data.DataSource({transport:{type:"json",read:{url:t,cache:!1,dataType:"json",data:addAntiForgeryToken},update:{url:o,type:"POST",dataType:"json",data:addAntiForgeryToken},destroy:{url:n,cache:!1,dataType:"json",data:addAntiForgeryToken},create:{url:a,type:"POST",dataType:"json",data:addAntiForgeryToken},parameterMap:function(e,t){if("read"===t)return addAntiForgeryToken({conditionGroupId:i});if("destroy"===t)return addAntiForgeryToken({conditionStatementId:e.ConditionStatementId});if("update"!==t&&"create"!==t)return JSON.stringify(e);var o=m("#condition-property-value").val(),n={conditionGroupId:i,id:e.ConditionStatementId,conditionTypeId:e.ConditionType.Id,conditionPropertyValue:e.ConditionProperty.Id,operatorTypeValue:e.ConditionPropertyOperator.Id,value:o};return addAntiForgeryToken(n)}},schema:{data:"Data",total:"Total",errors:"Errors",model:{id:"Id",fields:{Id:{type:"number",editable:!1},ConditionType:{defaultValue:{Id:0,Name:v}},ConditionProperty:{defaultValue:{Id:0,Name:F}},ConditionPropertyOperator:{defaultValue:{Id:0,Name:T}},ConditionPropertyValue:{defaultValue:{Id:0,Name:D}}}}},requestEnd:function(e){"create"!==e.type&&"update"!==e.type||this.read()},error:function(e){display_kendoui_grid_error(e),this.cancelChanges()},pageSize:f.getHiddenValFromDom("#defaultGridPageSize")});m("#"+e).kendoGrid({dataSource:r,pageable:{refresh:!0,pageSizes:f.getHiddenValFromDom("#gridPageSizes").split(",")},sortable:!0,editable:{mode:"popup",template:g.template(m("#popup_editor").html()),window:{animation:!1,width:400}},edit:function(e){function o(e){e.filter||(e.filter={}),e.filter.filters||(e.filter.filters=[]),e.filter.filters.unshift({field:"condition-property",operator:"eq",value:parseInt(c.value())}),e.filter.filters.unshift({field:"condition-type",operator:"eq",value:parseInt(l.value())})}function n(){var e=m("#condition-property-value").getKendoDropDownList(),t=m("#condition-property-value").getKendoComboBox(),o=m("#condition-property-value").getKendoNumericTextBox();e?(e.destroy(),e.wrapper.remove()):t?(t.destroy(),t.wrapper.remove()):o&&(o.destroy(),o.wrapper.remove()),m("#condition-property-value").remove()}function i(){var e=f.getHiddenValFromDom("#get-condition-property-values-url");return new g.data.DataSource({serverFiltering:!0,type:"json",transport:{read:{url:e,type:"POST",dataType:"json",contentType:"application/json"},parameterMap:function(e,t){return"read"!==t?e:(o(e),JSON.stringify(e))}}})}var a,t,r,d,p,l,u,c,s,y;a=e.model,t=f.getHiddenValFromDom("#get-condition-type-url"),r=f.getHiddenValFromDom("#available-condition-types"),d=JSON.parse(r),p=Object.keys(d),l=m("#condition-type").kendoDropDownList({optionLabel:v,dataValueField:"Id",dataTextField:"Name",dataSource:{type:"json",transport:{read:{url:t,type:"POST",dataType:"json",data:addAntiForgeryToken({conditionTypeIds:p})}}},change:n}).data("kendoDropDownList"),u=f.getHiddenValFromDom("#get-condition-properties-url"),c=m("#condition-property").kendoDropDownList({optionLabel:F,autoBind:!1,cascadeFrom:"condition-type",dataValueField:"Id",dataTextField:"Name",dataSource:{serverFiltering:!0,type:"json",transport:{read:{url:u,type:"POST",dataType:"json",contentType:"application/json"},parameterMap:function(e,t){return"read"!==t?e:(e.conditionPropertyIds=d[l.value()],JSON.stringify(e))}}},change:function(){var e=m("#condition-property-value").getKendoDropDownList(),t=m("#condition-property-value").getKendoComboBox(),o=m("#condition-property-value").getKendoNumericTextBox();e?e.value(""):t?t.value(""):o?o.value(""):m("#condition-property-value").val("")}}).data("kendoDropDownList"),s=f.getHiddenValFromDom("#get-condition-property-operators-url"),m("#condition-property-operator").kendoDropDownList({optionLabel:T,autoBind:!1,cascadeFrom:"condition-property",dataValueField:"Id",dataTextField:"Name",dataSource:{serverFiltering:!0,type:"json",transport:{read:{url:s,type:"POST",dataType:"json",contentType:"application/json"},parameterMap:function(e,t){return"read"!==t?e:(o(e),JSON.stringify(e))}}}}).data("kendoDropDownList"),y=f.getHiddenValFromDom("#get-condition-property-value-type-url"),m("#condition-property-value-type").kendoDropDownList({autoBind:!1,cascadeFrom:"condition-property",dataValueField:"Id",dataTextField:"Name",dataSource:{serverFiltering:!0,type:"json",transport:{read:{url:y,type:"POST",dataType:"json",contentType:"application/json",complete:function(){var e,t=m("#condition-property-value-type").data("kendoDropDownList").value();e=t,n(),m("<input />").attr({type:"text",id:"condition-property-value",name:"Value",required:"required",style:"width: 230px"}).appendTo("#condition-property-value-container"),a.isNew()||m("#condition-property-value").val(a.ConditionPropertyValue.Id),"1"===e?m("#condition-property-value").kendoComboBox({autoBind:!a.isNew(),placeholder:D,filter:"contains",dataValueField:"Id",dataTextField:"Name",delay:500,change:function(e){var t,o=e.sender;o.value()&&-1===o.selectedIndex&&(t=m("#conditionResources").attr("data-invalidEntry"),alert(t),o.value(""))},dataSource:i()}):"2"===e?m("#condition-property-value").kendoDropDownList({autoBind:!a.isNew(),optionLabel:D,dataValueField:"Id",dataTextField:"Name",dataSource:i()}):"3"===e&&m("#condition-property-value").kendoNumericTextBox()}},parameterMap:function(e,t){return"read"!==t?e:(o(e),JSON.stringify(e))}}}}).data("kendoDropDownList").wrapper.hide()},save:function(e){e.model.isNew()||(e.model.dirty=!0)},cancel:function(){this.cancelChanges()},toolbar:["create","destroy"],columns:[{field:"ConditionType",title:d,width:100,template:"#: ConditionType ? ConditionType.Name : null #"},{field:"ConditionProperty",title:p,width:100,template:"#: ConditionProperty ? ConditionProperty.Name : null #"},{field:"ConditionPropertyOperator",title:l,width:100,template:"#: ConditionPropertyOperator ? ConditionPropertyOperator.Name : null #"},{field:"ConditionPropertyValue",title:u,width:100,template:"#: ConditionPropertyValue ? ConditionPropertyValue.Name : null #"},{command:["edit","destroy"],title:"&nbsp;",width:"150px"}]})}m(document).ready(function(){!function(){var e=m.parseJSON(f.getHiddenValFromDom("#condition-groups"));if(null!=e)for(var t=0;t<e.length;t++)a(e[t]),r(e[t])}(),m(document).on("click","a.add-condition-group",t),m(document).on("click",".k-grid-toolbar a.k-grid-delete",o),m(document).on("change","#condition #ConditionName, #condition #Active",n),m(document).on("change","#condition #DefaultConditionValue",i),e=m("#conditionResources"),d=e.attr("data-conditionGroupType"),p=e.attr("data-conditionGroupProperty"),l=e.attr("data-conditionGroupOperator"),u=e.attr("data-conditionGroupValue"),v=e.attr("data-conditionGroupSelectType"),F=e.attr("data-conditionGroupSelectProperty"),T=e.attr("data-conditionGroupSelectOperator"),D=e.attr("data-conditionGroupSelectValue")})}(jQuery,kendo,sevenSpikesCore);